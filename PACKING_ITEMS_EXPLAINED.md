# Packing Items Table - Complete Explanation

## What Does the `packing_items` Table Store?

The `packing_items` table stores **individual items in a user's packing list** for each trip. Think of it as the detailed checklist of everything you need to pack.

---

## Table Structure

```sql
CREATE TABLE packing_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  trip_id UUID NOT NULL REFERENCES trips(id) ON DELETE CASCADE,
  
  -- Item details
  name VARCHAR(255) NOT NULL,
  category VARCHAR(50) NOT NULL,
  
  -- Item properties
  essential BOOLEAN DEFAULT false,
  packed BOOLEAN DEFAULT false,
  custom BOOLEAN DEFAULT false,
  quantity INTEGER DEFAULT 1,
  
  -- Metadata
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  notes TEXT
);
```

---

## Column Explanations

### Core Identification

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `id` | UUID | Unique identifier for each item | `550e8400-e29b-41d4-a716-446655440000` |
| `trip_id` | UUID | Links to the parent trip (foreign key) | `123e4567-e89b-12d3-a456-426614174000` |

**Relationship**: Each packing item belongs to exactly one trip. When a trip is deleted, all its packing items are automatically deleted (`ON DELETE CASCADE`).

---

### Item Details

| Column | Type | Description | Example Values |
|--------|------|-------------|----------------|
| `name` | VARCHAR(255) | Name of the item to pack | "Passport", "Sunscreen SPF 50", "Running Shoes" |
| `category` | VARCHAR(50) | Classification of the item | `'clothing'`, `'toiletries'`, `'electronics'`, `'travel_documents'`, `'medication'`, `'miscellaneous'` |

**Categories Explained:**
- **`clothing`**: Shirts, pants, jackets, shoes, accessories
- **`toiletries`**: Toothbrush, shampoo, deodorant, skincare
- **`electronics`**: Phone charger, laptop, camera, headphones
- **`travel_documents`**: Passport, visa, tickets, insurance
- **`medication`**: Prescriptions, first aid, vitamins
- **`miscellaneous`**: Everything else (books, snacks, travel pillow)

---

### Item Properties

| Column | Type | Default | Description | Use Case |
|--------|------|---------|-------------|----------|
| `essential` | BOOLEAN | `false` | Is this item critical? | Mark items like passport, medications as essential to prioritize packing |
| `packed` | BOOLEAN | `false` | Has user packed this item? | Used for checklist functionality - check it off when packed |
| `custom` | BOOLEAN | `false` | Did user add this manually? | Distinguishes between AI-generated items and user-added items |
| `quantity` | INTEGER | `1` | How many of this item? | "3 pairs of socks", "2 chargers", "5 t-shirts" |

**Property Details:**

- **`essential`**: 
  - Items AI determines are critical for the trip type
  - Example: Hiking boots for hiking trip, business suit for business trip
  - Can be toggled by user
  
- **`packed`**: 
  - Core checklist functionality
  - User checks off items as they pack them
  - Used to calculate completion percentage on trip

- **`custom`**: 
  - `false` = Generated by AI initially
  - `true` = User added this item themselves
  - Helps distinguish between AI recommendations and personal additions

- **`quantity`**: 
  - How many of this item to bring
  - Currently defaults to 1, but could be edited by user
  - Future feature: Quantity based on trip duration (e.g., one shirt per day)

---

### Metadata

| Column | Type | Description |
|--------|------|-------------|
| `created_at` | TIMESTAMPTZ | When item was added to packing list |
| `updated_at` | TIMESTAMPTZ | Last time item was modified |
| `notes` | TEXT | User's notes about this specific item |

**Notes Field Use Cases:**
- "Buy this before trip"
- "Borrow from John"
- "Check weather before deciding"
- "Size medium, blue color"

---

## Real-World Example

### Trip: "Weekend in Paris" (7 days, leisure)

```sql
-- Packing list for this trip would have rows like:

-- AI-Generated Essential Items
INSERT INTO packing_items (trip_id, name, category, essential, packed, custom, quantity) VALUES
('trip-123', 'Passport', 'travel_documents', true, false, false, 1),
('trip-123', 'Phone Charger', 'electronics', true, false, false, 1),
('trip-123', 'Toothbrush', 'toiletries', true, false, false, 1),
('trip-123', 'Comfortable Walking Shoes', 'clothing', true, false, false, 1);

-- AI-Generated Non-Essential Items
INSERT INTO packing_items (trip_id, name, category, essential, packed, custom, quantity) VALUES
('trip-123', 'Sunglasses', 'miscellaneous', false, false, false, 1),
('trip-123', 'Camera', 'electronics', false, false, false, 1),
('trip-123', 'Light Jacket', 'clothing', false, false, false, 1);

-- User Added Custom Items
INSERT INTO packing_items (trip_id, name, category, essential, packed, custom, quantity, notes) VALUES
('trip-123', 'French Phrasebook', 'miscellaneous', false, false, true, 1, 'Download offline version'),
('trip-123', 'Eiffel Tower Tickets', 'travel_documents', true, true, true, 2, 'Already printed');
```

### After User Packs Some Items:

```sql
-- User checks off items as they pack
UPDATE packing_items SET packed = true WHERE name = 'Passport';
UPDATE packing_items SET packed = true WHERE name = 'Eiffel Tower Tickets';

-- Statistics would show:
-- Total items: 9
-- Packed items: 2
-- Completion: 22%
```

---

## How It's Used in the Application

### 1. **Trip Creation Flow**

```
User creates trip → 
AI generates packing list → 
Items inserted into packing_items table →
Items grouped by category on frontend
```

**Code Example** (API call):
```typescript
// When trip is created, AI generates items
const packingList = await generatePackingListWithAI(tripData)

// Insert each item into database
for (const item of packingList) {
  await supabaseAdmin
    .from('packing_items')
    .insert({
      trip_id: trip.id,
      name: item.name,
      category: item.category,
      essential: item.essential,
      packed: false,
      custom: false
    })
}
```

### 2. **Packing List Display**

```
Fetch trip → 
Fetch all packing_items WHERE trip_id = ? →
Group by category →
Display as checklist
```

**Code Example** (from trip detail page):
```typescript
// src/hooks/useTripDetail.ts
const { trip, packingItems } = useTripDetail(tripId)

// Group items by category
const groupedItems = packingItems.reduce((acc, item) => {
  if (!acc[item.category]) acc[item.category] = []
  acc[item.category].push(item)
  return acc
}, {})

// Display:
// Clothing (3/5 packed)
//   ☐ T-shirts (qty: 3)
//   ☑ Jeans
//   ☐ Running shoes
// Electronics (1/2 packed)
//   ☑ Phone charger
//   ☐ Camera
```

### 3. **Checking Off Items**

```
User clicks checkbox →
API updates packing_items.packed = true →
Recalculate completion percentage →
Update UI
```

**Code Example**:
```typescript
// src/app/api/trips/[id]/items/[itemId]/route.ts
export async function PUT(request, { params }) {
  const { packed } = await request.json()
  
  await supabaseAdmin
    .from('packing_items')
    .update({ packed, updated_at: new Date().toISOString() })
    .eq('id', params.itemId)
    
  // Calculate new completion percentage
  const { data: allItems } = await supabaseAdmin
    .from('packing_items')
    .select('packed')
    .eq('trip_id', tripId)
  
  const totalItems = allItems.length
  const packedItems = allItems.filter(i => i.packed).length
  const completionPercentage = Math.round((packedItems / totalItems) * 100)
  
  // Update trip
  await supabaseAdmin
    .from('trips')
    .update({ completion_percentage: completionPercentage })
    .eq('id', tripId)
}
```

### 4. **Adding Custom Items**

```
User clicks "Add Item" →
Fills form (name, category) →
API inserts with custom=true →
Shows in list
```

**Code Example**:
```typescript
// User adds custom item
const newItem = await addItem({
  name: 'Travel Adapter',
  category: 'electronics',
  essential: true,
  custom: true // Marks as user-added
})
```

---

## Relationship with `trips` Table

### Parent-Child Relationship

```
trips (parent)
  ├── packing_items (child)
  ├── packing_items (child)
  └── packing_items (child)
```

**One-to-Many**: One trip has many packing items

### Database Constraint

```sql
trip_id UUID NOT NULL REFERENCES trips(id) ON DELETE CASCADE
```

**What this means:**
- Every packing item MUST belong to a trip
- If you delete a trip, all its packing items are automatically deleted
- You cannot have orphaned packing items

### Example Query

```sql
-- Get trip with all its packing items
SELECT 
  t.id as trip_id,
  t.destination_city,
  t.destination_country,
  t.duration,
  t.completion_percentage,
  json_agg(
    json_build_object(
      'id', pi.id,
      'name', pi.name,
      'category', pi.category,
      'packed', pi.packed,
      'essential', pi.essential
    )
  ) as packing_items
FROM trips t
LEFT JOIN packing_items pi ON pi.trip_id = t.id
WHERE t.id = 'trip-123'
GROUP BY t.id;
```

**Result:**
```json
{
  "trip_id": "trip-123",
  "destination_city": "Paris",
  "destination_country": "France",
  "duration": 7,
  "completion_percentage": 45,
  "packing_items": [
    {
      "id": "item-1",
      "name": "Passport",
      "category": "travel_documents",
      "packed": true,
      "essential": true
    },
    {
      "id": "item-2",
      "name": "Phone Charger",
      "category": "electronics",
      "packed": false,
      "essential": true
    }
  ]
}
```

---

## Common Queries

### Get all items for a trip, grouped by category

```typescript
const { data: packingItems } = await supabaseAdmin
  .from('packing_items')
  .select('*')
  .eq('trip_id', tripId)
  .order('category', { ascending: true })
  .order('essential', { ascending: false }) // Essential items first
  .order('name', { ascending: true })
```

### Get unpacked essential items

```typescript
const { data: essentialUnpacked } = await supabaseAdmin
  .from('packing_items')
  .select('name, category')
  .eq('trip_id', tripId)
  .eq('essential', true)
  .eq('packed', false)
```

### Calculate completion percentage

```typescript
const { data: items } = await supabaseAdmin
  .from('packing_items')
  .select('packed')
  .eq('trip_id', tripId)

const totalItems = items.length
const packedItems = items.filter(item => item.packed).length
const completionPercentage = Math.round((packedItems / totalItems) * 100)
```

### Add custom item

```typescript
const { data: newItem } = await supabaseAdmin
  .from('packing_items')
  .insert({
    trip_id: tripId,
    name: 'Travel Insurance Documents',
    category: 'travel_documents',
    essential: true,
    custom: true, // User-added
    quantity: 1
  })
  .select()
  .single()
```

---

## Summary

**`packing_items` table stores:**
- ✅ Individual items in a packing checklist
- ✅ Linked to specific trips (one trip = many items)
- ✅ Categorized for organization (clothing, electronics, etc.)
- ✅ Tracking: essential/not, packed/unpacked, AI/user-added
- ✅ Metadata: when added, last updated, custom notes

**Think of it as:**
A digital version of the paper checklist you'd make before a trip, but:
- Organized by category
- Trackable (check off as you pack)
- Reusable (duplicate trip = duplicate checklist)
- Intelligent (AI suggests items based on destination/type)
- Persistent (saved in database, accessible from any device)

**Real-world analogy:**
```
Trip = "Summer Vacation in Italy"
   ↓
Packing Items Table:
   [ ] Passport (essential, travel_documents)
   [ ] Sunscreen (essential, toiletries)  
   [x] Sunglasses (clothing) ← packed!
   [ ] Camera (electronics)
   [ ] Italian phrasebook (miscellaneous, user-added)
```
